/**!
 * The MIT License
 *
 * Copyright (c) 2013 the angular-openlayers-directive Team, http://tombatossals.github.io/angular-openlayers-directive
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 *
 * angular-google-maps
 * https://github.com/tombatossals/angular-openlayers-directive
 *
 * @authors https://github.com/tombatossals/angular-openlayers-directive/graphs/contributors
 */

/*! angular-openlayers-directive 22-12-2014 */
!function(){"use strict";!function(a,b){function c(){this.$get=["$$sanitizeUri",function(a){return function(b){var c=[];return f(b,i(c,function(b,c){return!/^unsafe/.test(a(b,c))})),c.join("")}}]}function d(a){var c=[],d=i(c,b.noop);return d.chars(a),c.join("")}function e(a){var b,c={},d=a.split(",");for(b=0;b<d.length;b++)c[d[b]]=!0;return c}function f(a,c){function d(a,d,f,h){if(d=b.lowercase(d),y[d])for(;t.last()&&z[t.last()];)e("",t.last());x[d]&&t.last()==d&&e("",d),h=u[d]||!!h,h||t.push(d);var i={};f.replace(m,function(a,b,c,d,e){var f=c||d||e||"";i[b]=g(f)}),c.start&&c.start(d,i,h)}function e(a,d){var e,f=0;if(d=b.lowercase(d))for(f=t.length-1;f>=0&&t[f]!=d;f--);if(f>=0){for(e=t.length-1;e>=f;e--)c.end&&c.end(t[e]);t.length=f}}"string"!=typeof a&&(a=null===a||"undefined"==typeof a?"":""+a);var f,h,i,s,t=[],v=a;for(t.last=function(){return t[t.length-1]};a;){if(s="",h=!0,t.last()&&B[t.last()]?(a=a.replace(new RegExp("(.*)<\\s*\\/\\s*"+t.last()+"[^>]*>","i"),function(a,b){return b=b.replace(p,"$1").replace(r,"$1"),c.chars&&c.chars(g(b)),""}),e("",t.last())):(0===a.indexOf("<!--")?(f=a.indexOf("--",4),f>=0&&a.lastIndexOf("-->",f)===f&&(c.comment&&c.comment(a.substring(4,f)),a=a.substring(f+3),h=!1)):q.test(a)?(i=a.match(q),i&&(a=a.replace(i[0],""),h=!1)):o.test(a)?(i=a.match(l),i&&(a=a.substring(i[0].length),i[0].replace(l,e),h=!1)):n.test(a)&&(i=a.match(k),i?(i[4]&&(a=a.substring(i[0].length),i[0].replace(k,d)),h=!1):(s+="<",a=a.substring(1))),h&&(f=a.indexOf("<"),s+=0>f?a:a.substring(0,f),a=0>f?"":a.substring(f),c.chars&&c.chars(g(s)))),a==v)throw j("badparse","The sanitizer was unable to parse the following block of html: {0}",a);v=a}e()}function g(a){if(!a)return"";var b=I.exec(a),c=b[1],d=b[3],e=b[2];return e&&(H.innerHTML=e.replace(/</g,"&lt;"),e="textContent"in H?H.textContent:H.innerText),c+e+d}function h(a){return a.replace(/&/g,"&amp;").replace(s,function(a){var b=a.charCodeAt(0),c=a.charCodeAt(1);return"&#"+(1024*(b-55296)+(c-56320)+65536)+";"}).replace(t,function(a){return"&#"+a.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}function i(a,c){var d=!1,e=b.bind(a,a.push);return{start:function(a,f,g){a=b.lowercase(a),!d&&B[a]&&(d=a),d||C[a]!==!0||(e("<"),e(a),b.forEach(f,function(d,f){var g=b.lowercase(f),i="img"===a&&"src"===g||"background"===g;G[g]!==!0||D[g]===!0&&!c(d,i)||(e(" "),e(f),e('="'),e(h(d)),e('"'))}),e(g?"/>":">"))},end:function(a){a=b.lowercase(a),d||C[a]!==!0||(e("</"),e(a),e(">")),a==d&&(d=!1)},chars:function(a){d||e(h(a))}}}var j=b.$$minErr("$sanitize"),k=/^<((?:[a-zA-Z])[\w:-]*)((?:\s+[\w:-]+(?:\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|[^>\s]+))?)*)\s*(\/?)\s*(>?)/,l=/^<\/\s*([\w:-]+)[^>]*>/,m=/([\w:-]+)(?:\s*=\s*(?:(?:"((?:[^"])*)")|(?:'((?:[^'])*)')|([^>\s]+)))?/g,n=/^</,o=/^<\//,p=/<!--(.*?)-->/g,q=/<!DOCTYPE([^>]*?)>/i,r=/<!\[CDATA\[(.*?)]]>/g,s=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,t=/([^\#-~| |!])/g,u=e("area,br,col,hr,img,wbr"),v=e("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),w=e("rp,rt"),x=b.extend({},w,v),y=b.extend({},v,e("address,article,aside,blockquote,caption,center,del,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,map,menu,nav,ol,pre,script,section,table,ul")),z=b.extend({},w,e("a,abbr,acronym,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,q,ruby,rp,rt,s,samp,small,span,strike,strong,sub,sup,time,tt,u,var")),A=e("animate,animateColor,animateMotion,animateTransform,circle,defs,desc,ellipse,font-face,font-face-name,font-face-src,g,glyph,hkern,image,linearGradient,line,marker,metadata,missing-glyph,mpath,path,polygon,polyline,radialGradient,rect,set,stop,svg,switch,text,title,tspan,use"),B=e("script,style"),C=b.extend({},u,y,z,x,A),D=e("background,cite,href,longdesc,src,usemap,xlink:href"),E=e("abbr,align,alt,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,coords,dir,face,headers,height,hreflang,hspace,ismap,lang,language,nohref,nowrap,rel,rev,rows,rowspan,rules,scope,scrolling,shape,size,span,start,summary,target,title,type,valign,value,vspace,width"),F=e("accent-height,accumulate,additive,alphabetic,arabic-form,ascent,attributeName,attributeType,baseProfile,bbox,begin,by,calcMode,cap-height,class,color,color-rendering,content,cx,cy,d,dx,dy,descent,display,dur,end,fill,fill-rule,font-family,font-size,font-stretch,font-style,font-variant,font-weight,from,fx,fy,g1,g2,glyph-name,gradientUnits,hanging,height,horiz-adv-x,horiz-origin-x,ideographic,k,keyPoints,keySplines,keyTimes,lang,marker-end,marker-mid,marker-start,markerHeight,markerUnits,markerWidth,mathematical,max,min,offset,opacity,orient,origin,overline-position,overline-thickness,panose-1,path,pathLength,points,preserveAspectRatio,r,refX,refY,repeatCount,repeatDur,requiredExtensions,requiredFeatures,restart,rotate,rx,ry,slope,stemh,stemv,stop-color,stop-opacity,strikethrough-position,strikethrough-thickness,stroke,stroke-dasharray,stroke-dashoffset,stroke-linecap,stroke-linejoin,stroke-miterlimit,stroke-opacity,stroke-width,systemLanguage,target,text-anchor,to,transform,type,u1,u2,underline-position,underline-thickness,unicode,unicode-range,units-per-em,values,version,viewBox,visibility,width,widths,x,x-height,x1,x2,xlink:actuate,xlink:arcrole,xlink:role,xlink:show,xlink:title,xlink:type,xml:base,xml:lang,xml:space,xmlns,xmlns:xlink,y,y1,y2,zoomAndPan"),G=b.extend({},D,F,E),H=document.createElement("pre"),I=/^(\s*)([\s\S]*?)(\s*)$/;b.module("ngSanitize",[]).provider("$sanitize",c),b.module("ngSanitize").filter("linky",["$sanitize",function(a){var c=/((ftp|https?):\/\/|(www\.)|(mailto:)?[A-Za-z0-9._%+-]+@)\S*[^\s.;,(){}<>"”’]/,e=/^mailto:/;return function(f,g){function h(a){a&&n.push(d(a))}function i(a,c){n.push("<a "),b.isDefined(g)&&n.push('target="',g,'" '),n.push('href="',a.replace(/"/g,"&quot;"),'">'),h(c),n.push("</a>")}if(!f)return f;for(var j,k,l,m=f,n=[];j=m.match(c);)k=j[0],j[2]||j[4]||(k=(j[3]?"http://":"mailto:")+k),l=j.index,h(m.substr(0,l)),i(k,j[0].replace(e,"")),m=m.substring(l+j[0].length);return h(m),a(n.join(""))}}])}(window,window.angular),angular.module("openlayers-directive",["ngSanitize"]).directive("openlayers",["$log","$q","$compile","olHelpers","olMapDefaults","olData",function(a,b,c,d,e,f){var g;return{restrict:"EA",transclude:!0,replace:!0,scope:{center:"=olCenter",defaults:"=olDefaults",layers:"=olLayers",view:"=olView",controls:"=olControls",events:"=olEvents"},template:'<div class="angular-openlayers-map"><div style="display: none;" ng-transclude></div></div>',controller:["$scope",function(a){g=b.defer(),this.getMap=function(){return g.promise},this.getOpenlayersScope=function(){return a}}],link:function(a,b,c){var h=d.isDefined,i=d.createLayer,j=d.createView,k=e.setDefaults(a.defaults,c.id);h(c.width)&&(isNaN(c.width)?b.css("width",c.width):b.css("width",c.width+"px")),h(c.height)&&(isNaN(c.height)?b.css("height",c.height):b.css("height",c.height+"px"));var l=ol.control.defaults(k.controls),m=ol.interaction.defaults(k.interactions),n=j(k.view),o=new ol.Map({target:b[0],controls:l,interactions:m,renderer:k.renderer,view:n});if(h(c.olControls)||f.setControls(o.getControls()),!h(c.olLayers)){var p=i(k.layers.main);o.addLayer(p);var q=o.getLayers();f.setLayers(q,c.id)}h(c.olCenter)||(n.setCenter([k.center.lon,k.center.lat]),n.setZoom(k.center.zoom)),f.setMap(o,c.id),g.resolve(o)}}}]),angular.module("openlayers-directive").directive("olCenter",["$log","$location","olMapDefaults","olHelpers",function(a,b,c,d){return{restrict:"A",scope:!1,replace:!1,require:"openlayers",link:function(e,f,g,h){var i=d.safeApply,j=d.isValidCenter,k=d.isDefined,l=d.isArray,m=d.isNumber,n=d.isSameCenterOnMap,o=d.setCenter,p=d.setZoom,q=h.getOpenlayersScope();h.getMap().then(function(e){var f=c.getDefaults(g.id),h=e.getView(),r=q.center;if(-1!==g.olCenter.search("-"))return a.error('[AngularJS - Openlayers] The "center" variable can\'t use a "-" on his key name: "'+g.center+'".'),void o(h,f.view.projection,f.center,e);k(r)||(r={}),j(r)||(a.warn("[AngularJS - Openlayers] invalid 'center'"),r.lat=f.center.lat,r.lon=f.center.lon,r.zoom=f.center.zoom,r.projection=f.center.projection),r.projection||(r.projection="pixel"!==f.view.projection?f.center.projection:"pixel"),m(r.zoom)||(r.zoom=1),o(h,f.view.projection,r,e),h.setZoom(r.zoom);var s;if(r.centerUrlHash===!0){var t=function(){var a,c=b.search();if(k(c.c)){var d=c.c.split(":");3===d.length&&(a={lat:parseFloat(d[0]),lon:parseFloat(d[1]),zoom:parseInt(d[2],10)})}return a};s=t(),q.$on("$locationChangeSuccess",function(){var a=t();a&&!n(a,e)&&i(q,function(b){b.center.lat=a.lat,b.center.lon=a.lon,b.center.zoom=a.zoom})})}var u;q.$watch("center",function(b){if(b){if(b.projection||(b.projection=f.center.projection),b.autodiscover)return u||(u=new ol.Geolocation({projection:ol.proj.get(b.projection)}),u.on("change",function(){if(b.autodiscover){var a=u.getPosition();i(q,function(b){b.center.lat=a[1],b.center.lon=a[0],b.center.zoom=12,b.center.autodiscover=!1,u.setTracking(!1)})}})),void u.setTracking(!0);j(b)||(a.warn("[AngularJS - Openlayers] invalid 'center'"),b=f.center);var c=h.getCenter();if(c){if("pixel"===f.view.projection)return void h.setCenter(b.coord);var d=ol.proj.transform(c,f.view.projection,b.projection);(d[1]!==b.lat||d[0]!==b.lon)&&o(h,f.view.projection,b,e)}h.getZoom()!==b.zoom&&p(h,b.zoom,e)}},!0),e.on("moveend",function(){i(q,function(a){if(k(a.center)){var c=e.getView().getCenter();if(a.center.zoom=h.getZoom(),"pixel"===f.view.projection)return void(a.center.coord=c);if(a.center){var g=ol.proj.transform(c,f.view.projection,a.center.projection);if(a.center.lat=g[1],a.center.lon=g[0],d.notifyCenterUrlHashChanged(q,a.center,b.search()),l(a.center.bounds)){var i=h.calculateExtent(e.getSize()),j=a.center.projection,m=f.view.projection;a.center.bounds=ol.proj.transform(i,m,j)}}}})})})}}}]),angular.module("openlayers-directive").directive("olLayers",["$log","$q","olData","olMapDefaults","olHelpers",function(a,b,c,d,e){var f;return{restrict:"A",scope:!1,replace:!1,require:"openlayers",controller:function(){f=b.defer(),this.getLayers=function(){return f.promise}},link:function(b,g,h,i){var j=e.isDefined,k=e.equals,l={},m=i.getOpenlayersScope(),n=e.createLayer,o=e.createStyle,p=e.isBoolean;i.getMap().then(function(b){var e=d.getDefaults(h.id),g=b.getView().getProjection();m.$watch("layers",function(d,i){j(d)||(a.warn("[AngularJS - OpenLayers] At least one layer has to be defined."),d=angular.copy(e.layers));var m,q=d[Object.keys(d)[0]];j(q)&&j(q.source)&&j(q.source.type)||(a.warn("[AngularJS - OpenLayers] At least one layer has to be defined."),d=angular.copy(e.layers));var r=function(a,b){var c=b.getLayers();c.forEach(function(c){c===a&&b.removeLayer(a)})};for(m in l)q=l[m],d.hasOwnProperty(m)||(r(q,b),delete l[m]);for(m in d){q=d[m];var s,t;if(j(q.visible)||(q.visible=!0),j(q.opacity)||(q.opacity=1),l.hasOwnProperty(m)){q=d[m];var u=i[m];if(s=l[m],j(u)&&!k(q,u)){if(!k(q.source,u.source))for(var v=b.getLayers(),w=0;w<v.getLength();w++){var x=v.item(w);x===s&&(v.removeAt(w),s=n(q,g),j(s)&&(l[m]=s,v.insertAt(w,s)))}p(q.visible)&&q.visible!==u.visible&&s.setVisible(q.visible),q.opacity&&q.opacity!==u.opacity&&s.setOpacity(q.opacity),q.style&&!k(q.style,u.style)&&(t=angular.isFunction(q.style)?q.style:o(q.style),s.setStyle(t))}}else s=n(d[m],g),j(s)&&(l[m]=s,b.addLayer(s),p(q.visible)&&s.setVisible(q.visible),q.opacity&&s.setOpacity(q.opacity),q.style&&(t=angular.isFunction(q.style)?q.style:o(q.style),s.setStyle(t)))}f.resolve(l),c.setLayers(l,h.id)},!0)})}}}]),angular.module("openlayers-directive").directive("olEvents",["$log","$q","olData","olMapDefaults","olHelpers",function(a,b,c,d,e){return{restrict:"A",scope:!1,replace:!1,require:["openlayers","?olLayers"],link:function(a,c,d,f){var g=e.setEvents,h=e.isDefined,i=f[0],j=i.getOpenlayersScope();i.getMap().then(function(a){var c;c=h(f[1])&&null!==f[1]?f[1].getLayers:function(){var a=b.defer();return a.resolve(),a.promise},c().then(function(b){j.$watch("events",function(c){g(c,a,j,b)})})})}}}]),angular.module("openlayers-directive").directive("olView",["$log","$q","olData","olMapDefaults","olHelpers",function(a,b,c,d,e){return{restrict:"A",scope:!1,replace:!1,require:"openlayers",link:function(a,b,c,f){var g=f.getOpenlayersScope(),h=e.isNumber,i=e.safeApply,j=e.createView;f.getMap().then(function(a){var b=d.getDefaults(c.id),e=g.view;e.projection||(e.projection=b.view.projection),e.maxZoom||(e.maxZoom=b.view.maxZoom),e.minZoom||(e.minZoom=b.view.minZoom),e.rotation||(e.rotation=b.view.rotation);var f=j(e);a.setView(f),g.$watch("view",function(a){h(a.rotation)&&f.setRotation(a.rotation)},!0),f.on("change:rotation",function(){i(g,function(b){b.view.rotation=a.getView().getRotation()})})})}}}]),angular.module("openlayers-directive").directive("olControls",["$log","$q","olData","olMapDefaults","olHelpers",function(a,b,c,d,e){return{restrict:"A",scope:!1,replace:!1,require:"openlayers",link:function(a,b,c,f){var g=f.getOpenlayersScope();f.getMap().then(function(a){var b=d.getDefaults(c.id),f=e.detectControls,h=e.getControlClasses,i=g.controls;for(var j in b.controls)i.hasOwnProperty(j)||(i[j]=b.controls[j]);g.$watch("controls",function(b){var c,d=f(a.getControls()),e=h();for(c in d)b.hasOwnProperty(c)&&b[c]!==!1||(a.removeControl(d[c]),delete d[c]);for(c in b)b[c]!==!0&&!angular.isObject(b[c])||d.hasOwnProperty(c)||a.addControl(new e[c])},!0)})}}}]),angular.module("openlayers-directive").directive("olMarker",["$log","$q","olMapDefaults","olHelpers",function(a,b,c,d){var e=function(){var a="data:image/png;base64,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";return{projection:"EPSG:4326",lat:0,lon:0,coord:[],focus:!0,showOnMouseOver:!1,style:new ol.style.Style({image:new ol.style.Icon({anchor:[.5,1],anchorXUnits:"fraction",anchorYUnits:"fraction",opacity:.9,src:a})})}};return{restrict:"E",scope:{lat:"=lat",lon:"=lon",label:"=label",properties:"=olMarkerProperties"},require:["^openlayers","?^olLayers"],replace:!0,template:'<div class="popup-label" ng-bind-html="message"></div>',link:function(f,g,h,i){var j,k=d.isDefined,l=i[0],m=d.createMarkerLayer,n=d.createMarker,o=d.createOverlay;j=k(i[1])&&null!==i[1]?i[1].getLayers:function(){var a=b.defer();return a.resolve(),a.promise},l.getMap().then(function(b){j().then(function(){var d=m();b.addLayer(d);var i,j,l,p=e(),q=c.getDefaults(h.id),r=q.view.projection;return f.$on("$destroy",function(){b.removeLayer(d)}),k(f.properties)?void f.$watch("properties",function(c){k(l)||(p.projection=c.projection?c.projection:p.projection,p.coord=c.coord?c.coord:p.coord,p.lat=c.lat?c.lat:p.lat,p.lon=c.lon?c.lon:p.lon,l=n(p,r),k(l)||a.error("[AngularJS - Openlayers] Received invalid data on the marker."),d.getSource().addFeature(l)),k(i)&&b.removeOverlay(i),f.message=c.label.message,k(f.message)&&0!==f.message.length&&(c.label&&c.label.focus===!0&&(j="pixel"===p.projection?p.coord:ol.proj.transform([p.lon,p.lat],p.projection,r),i=o(g,j),b.addOverlay(i)),i&&c.label&&c.label.focus===!1&&(b.removeOverlay(i),i=void 0),c.label&&c.label.focus===!1&&c.label.showOnMouseOver&&b.getViewport().addEventListener("mousemove",function(a){if(!c.label.focus){var d=!1,e=b.getEventPixel(a),f=b.forEachFeatureAtPixel(e,function(a){return a});f===l&&(d=!0,k(i)||(j="pixel"===p.projection?p.coord:ol.proj.transform([p.lon,p.lat],p.projection,r),i=o(g,j),b.addOverlay(i)),b.getTarget().style.cursor="pointer"),!d&&i&&(b.removeOverlay(i),i=void 0,b.getTarget().style.cursor="")}}))},!0):(p.lat=f.lat?f.lat:p.lat,p.lon=f.lon?f.lon:p.lon,p.message=h.message,l=n(p,r),k(l)||a.error("[AngularJS - Openlayers] Received invalid data on the marker."),d.getSource().addFeature(l),void(p.message&&(f.message=h.message,j=ol.proj.transform([p.lon,p.lat],p.projection,r),i=o(g,j),b.addOverlay(i))))})})}}}]),angular.module("openlayers-directive").service("olData",["$log","$q","olHelpers",function(a,b,c){var d=c.obtainEffectiveMapId,e={},f={},g={},h={},i=function(a,b){var c=d(a,b);a[c].resolvedDefer=!0},j=function(a,c){var e,f=d(a,c);return angular.isDefined(a[f])&&a[f].resolvedDefer!==!0?e=a[f].defer:(e=b.defer(),a[f]={defer:e,resolvedDefer:!1}),e},k=function(a,b){var c,e=d(a,b);return c=angular.isDefined(a[e])&&a[e].resolvedDefer!==!1?a[e].defer:j(a,b)};this.setMap=function(a,b){var c=j(e,b);c.resolve(a),i(e,b)},this.getMap=function(a){var b=k(e,a);return b.promise},this.getLayers=function(a){var b=k(f,a);return b.promise},this.setLayers=function(a,b){var c=j(f,b);c.resolve(a),i(f,b)},this.getMarkers=function(a){var b=k(g,a);return b.promise},this.setMarkers=function(a,b){var c=j(g,b);c.resolve(a),i(g,b)},this.getControls=function(a){var b=k(h,a);return b.promise},this.setControls=function(a,b){var c=j(h,b);c.resolve(a),i(h,b)}}]),angular.module("openlayers-directive").factory("olHelpers",["$q","$log",function(a,b){var c=function(a){return angular.isDefined(a)},d=function(a,b,c){"pointermove"===b?a.on("pointermove",function(d){var e=d.coordinate;c.$emit("openlayers.map."+b,{lat:e[1],lon:e[0],projection:a.getView().getProjection().getCode()})}):"singleclick"===b&&a.on("singleclick",function(d){var e=d.coordinate;c.$emit("openlayers.map."+b,{lat:e[1],lon:e[0],projection:a.getView().getProjection().getCode()})})},e=["Road","Aerial","AerialWithLabels","collinsBart","ordnanceSurvey"],f=function(){return{attribution:ol.control.Attribution,fullscreen:ol.control.FullScreen,mouseposition:ol.control.MousePosition,rotate:ol.control.Rotate,scaleline:ol.control.ScaleLine,zoom:ol.control.Zoom,zoomslider:ol.control.ZoomSlider,zoomtoextent:ol.control.ZoomToExtent}},g=["osm","sat","hyb"],h=function(a){var b,c;return a.fill&&(b=new ol.style.Fill({color:a.fill.color})),a.stroke&&(c=new ol.style.Stroke({color:a.stroke.color,width:a.stroke.width})),new ol.style.Style({fill:b,stroke:c})},i=function(a){if(a.type)return a.type;switch(a.source.type){case"ImageWMS":return"Image";case"ImageStatic":return"Image";case"GeoJSON":return"Vector";case"TopoJSON":return"Vector";default:return"Tile"}},j=function(a){var d;switch(a.projection){case"pixel":if(!c(a.extent))return void b.error("[AngularJS - Openlayers] - You must provide the extent of the image if using pixel projection");d=new ol.proj.Projection({code:"pixel",units:"pixels",extent:a.extent});break;default:d=new ol.proj.get(a.projection)}return d},k=function(a){return-1!==["watercolor","terrain","toner"].indexOf(a)},l=function(a,d){var f;switch(a.type){case"ImageWMS":a.url&&a.params||b.error("[AngularJS - Openlayers] - ImageWMS Layer needs valid server url and params properties"),f=new ol.source.ImageWMS({url:a.url,crossOrigin:a.crossOrigin?a.crossOrigin:"anonymous",params:a.params});break;case"TileWMS":a.url&&a.params||b.error("[AngularJS - Openlayers] - TileWMS Layer needs valid url and params properties"),f=new ol.source.TileWMS({url:a.url,crossOrigin:a.crossOrigin?a.crossOrigin:"anonymous",params:a.params});break;case"OSM":f=a.attribution?new ol.source.OSM({attributions:[new ol.Attribution({html:a.attribution}),ol.source.OSM.DATA_ATTRIBUTION]}):new ol.source.OSM,a.url&&f.setUrl(a.url);break;case"BingMaps":if(!a.key)return void b.error("[AngularJS - Openlayers] - You need an API key to show the Bing Maps.");f=new ol.source.BingMaps({key:a.key,imagerySet:a.imagerySet?a.imagerySet:e[0]});break;case"MapQuest":if(!a.layer||-1===g.indexOf(a.layer))return void b.error("[AngularJS - Openlayers] - MapQuest layers needs a valid 'layer' property.");f=new ol.source.MapQuest({layer:a.layer});break;case"GeoJSON":if(!a.geojson&&!a.url)return void b.error("[AngularJS - Openlayers] - You need a geojson property to add a GeoJSON layer.");a.url?f=new ol.source.GeoJSON({projection:d,url:a.url}):(c(a.geojson.projection)||(a.geojson.projection=d),f=new ol.source.GeoJSON(a.geojson));break;case"TopoJSON":if(!a.topojson&&!a.url)return void b.error("[AngularJS - Openlayers] - You need a topojson property to add a TopoJSON layer.");f=new ol.source.TopoJSON(a.url?{projection:d,url:a.url}:a.topojson);break;case"TileJSON":f=new ol.source.TileJSON({url:a.url,crossOrigin:"anonymous"});break;case"KML":f=new ol.source.KML({url:a.url,projection:a.projection,radius:a.radius,extractStyles:!1});break;case"Stamen":if(!a.layer||!k(a.layer))return void b.error("[AngularJS - Openlayers] - You need a valid Stamen layer.");f=new ol.source.Stamen({layer:a.layer});break;case"ImageStatic":if(!a.url||!angular.isArray(a.imageSize)||2!==a.imageSize.length)return void b.error("[AngularJS - Openlayers] - You need a image URL to create a ImageStatic layer.");f=new ol.source.ImageStatic({url:a.url,imageSize:a.imageSize,projection:d,imageExtent:d.getExtent()})}return f};return{isDefined:c,isNumber:function(a){return angular.isNumber(a)},createView:function(a){var b=j(a);return new ol.View({projection:b,maxZoom:a.maxZoom,minZoom:a.minZoom})},isDefinedAndNotNull:function(a){return angular.isDefined(a)&&null!==a},isString:function(a){return angular.isString(a)},isArray:function(a){return angular.isArray(a)},isObject:function(a){return angular.isObject(a)},equals:function(a,b){return angular.equals(a,b)},isValidCenter:function(a){return angular.isDefined(a)&&(angular.isNumber(a.lat)&&angular.isNumber(a.lon)||angular.isArray(a.coord)&&2===a.coord.length&&angular.isNumber(a.coord[0])&&angular.isNumber(a.coord[1])||angular.isArray(a.bounds)&&4===a.bounds.length&&angular.isNumber(a.bounds[0])&&angular.isNumber(a.bounds[1])&&angular.isNumber(a.bounds[1])&&angular.isNumber(a.bounds[2]))},safeApply:function(a,b){var c=a.$root.$$phase;"$apply"===c||"$digest"===c?a.$eval(b):a.$apply(b)},isSameCenterOnMap:function(a,b){var c=b.getView().getCenter(),d=b.getView().getZoom();return c[1].toFixed(4)===a.lat.toFixed(4)&&c[1].toFixed(4)===a.lon.toFixed(4)&&d===a.zoom?!0:!1},setCenter:function(a,b,c,d){if(d&&a.getCenter()){var e=ol.animation.pan({duration:150,source:a.getCenter()});d.beforeRender(e)}if(c.projection===b)a.setCenter([c.lon,c.lat]);else{var f=[c.lon,c.lat];a.setCenter(ol.proj.transform(f,c.projection,b))}},setZoom:function(a,b,c){var d=ol.animation.zoom({duration:150,resolution:c.getView().getResolution()});c.beforeRender(d),a.setZoom(b)},isBoolean:function(a){return"boolean"==typeof a},obtainEffectiveMapId:function(a,c){var d,e;if(angular.isDefined(c))d=c;else if(1===Object.keys(a).length)for(e in a)a.hasOwnProperty(e)&&(d=e);else 0===Object.keys(a).length?d="main":b.error("[AngularJS - Openlayers] - You have more than 1 map on the DOM, you must provide the map ID to the olData.getXXX call");return d},generateUniqueUID:function(){function a(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()},createStyle:h,setEvents:function(a,b,e,f){if(c(a)){if(angular.isArray(a.map))for(var g in a.map){var h=a.map[g];d(b,h,e)}c(f)&&c(a.layers)&&angular.isArray(a.layers.vector)&&angular.forEach(a.layers.vector,function(a){angular.element(b.getViewport()).on(a,function(c){var d=b.getEventPixel(c),f=b.forEachFeatureAtPixel(d,function(a){return a});e.$emit("openlayers.geojson."+a,f,c)})})}},detectLayerType:i,createLayer:function(a,b){var c,d=i(a),e=l(a.source,b);if(e){switch(d){case"Image":c=new ol.layer.Image({source:e});break;case"Tile":c=new ol.layer.Tile({source:e});break;case"Heatmap":c=new ol.layer.Heatmap({source:e});break;case"Vector":var f;a.style&&(f=angular.isFunction(a.style)?a.style:h(a.style)),c=new ol.layer.Vector({source:e,style:f})}return angular.isNumber(a.opacity)&&c.setOpacity(a.opacity),c}},createMarkerLayer:function(){return new ol.layer.Vector({source:new ol.source.Vector})},notifyCenterUrlHashChanged:function(a,b,d){if(b.centerUrlHash){var e=b.lat.toFixed(4)+":"+b.lon.toFixed(4)+":"+b.zoom;c(d.c)&&d.c===e||a.$emit("centerUrlHash",e)}},getControlClasses:f,detectControls:function(a){var b={},c=f();return a.forEach(function(a){for(var d in c)a instanceof c[d]&&(b[d]=a)}),b},createMarker:function(a,b){var c;c="pixel"===b?new ol.geom.Point(a.coord):new ol.geom.Point([a.lon,a.lat]).transform(a.projection,b);var d=new ol.Feature({geometry:c});return d.setStyle(a.style),d},createOverlay:function(a,b){var c=new ol.Overlay({position:b,element:a,positioning:"center-left"});return c}}}]),angular.module("openlayers-directive").factory("olMapDefaults",["$q","olHelpers",function(a,b){var c=function(){return{view:{projection:"EPSG:3857",minZoom:void 0,maxZoom:void 0,rotation:0,extent:void 0},layers:{main:{type:"Tile",source:{type:"OSM"}}},center:{lat:0,lon:0,zoom:1,autodiscover:!1,bounds:[],centerUrlHash:!1,projection:"EPSG:4326"},events:{map:["click"]},controls:{attribution:!0,rotate:!1,zoom:!0},renderer:"canvas"}},d=b.isDefined,e=b.obtainEffectiveMapId,f={};return{getDefaults:function(a){var b=e(f,a);return f[b]},setDefaults:function(a,b){var g=c();d(a)&&(d(a.layers)&&(g.layers=angular.copy(a.layers)),d(a.controls)&&(g.controls=angular.copy(a.controls)),d(a.interactions)&&(g.interactions=angular.copy(a.interactions)),d(a.renderer)&&(g.renderer=a.renderer),d(a.view)&&(g.view.maxZoom=a.view.maxZoom||g.view.maxZoom,g.view.minZoom=a.view.minZoom||g.view.minZoom,g.view.projection=a.view.projection||g.view.projection,g.view.extent=a.view.extent||g.view.extent));var h=e(f,b);return f[h]=g,g}}}])}();